### [Назад к оглавлению](../../../../../README.md)

# Maven

1. Узнаем, что такое сборщик проектов и рассмотрим типы сборщиков.
2. Познакомимся с фреймворком Maven.
3. Научимся создавать проекты с архетипом quickstart.

## Оглавление

- [Сборщик проектов](#сборщик-проектов)
- [Виды сборщиков проектов](#виды-сборщиков-проектов)
- [Maven. Полное погружение](#maven-полное-погружение)
- [Структура проекта](#структура-проекта)
    - [Описание примерной базовой иерархии файлов в проекте](#описание-примерной-базовой-иерархии-файлов-в-проекте)
- [Файл POM](#файл-pom)
    - [Значения тега scope](#значения-тега-scope)
- [Жизненный цикл сборки](#жизненный-цикл-сборки)
    - [Фазы жизненного цикла сборки](#фазы-жизненного-цикла-сборки)
- [Плагины](#плагины)
    - [Типы плагинов в Maven](#типы-плагинов-в-maven)
- [Репозитории](#репозитории)
    - [Локальные](#локальные)
    - [Центральный репозиторий](#центральный-репозиторий)
    - [Удалённый репозиторий](#удалённый-репозиторий)
- [Порядок поиска зависимостей Maven](#порядок-поиска-зависимостей-maven)
- [Практическое задание](#практическое-задание)

## Сборщик проектов

В жизни каждого программиста возникает момент, когда маленьких и простых приложений недостаточно для решения поставленных задач. Иногда даже стандартного
инструментария Java недостаточно. Тогда используются чужие библиотеки и фреймворки.

Раньше разработчики просто делились файлами своих библиотек друг с другом и подключали их к своему проекту. Проще говоря, клали файлы в соответствующую
директорию. У такого подхода есть три проблемы:

1. Сложно следить за версиями библиотек. Если твой друг выпустил версию 2.0, а тебе не сказал, это полбеды. А вот если ты уже скачал новую версию, удалил старый
   файл библиотеки, а оказалось, что новый файл требует ещё каких-то других библиотек.
2. Проблема коллаборации. Если над проектом работали 50 программистов, и один стал использовать функции из новой библиотеки, а его коллеги из другого модуля ещё
   нет, возникали конфликты — сначала в коде, а затем в отношениях.
3. Сложно управлять кодом чужих библиотек. Нельзя выкачать только часть библиотеки или настроить этапы, на которых эта зависимость используется, нельзя
   автоматизировать рутинные задачи при сборке проекта.

Сборщики проектов — это фреймворки, которые автоматизируют сборку. Их можно подключить практически в любом проекте. Даже загрузка дополнительных jar-библиотек
занимает время, а со сборщиком все требуемые библиотеки подтягиваются из удалённого репозитория.

### Виды сборщиков проектов

Первой утилитой сборки можно назвать make. Эта утилита собирала проекты на языках C и C++. Она до сих пор популярна, хоть и не приносит Java-разработчику
большой пользы. Но именно с этой утилиты началось становление платформонезависимых сборщиков.

В отличие от make, утилита Ant полностью независима от платформы. Требуется только установка на применяемой системе рабочей среды Java — JRE. Отказ от
использования команд операционной системы и формат XML обеспечивают переносимость сценариев.

Управление процессом сборки происходит посредством XML-сценария или Build-файла. Он содержит определение проекта, состоящего из отдельных целей (Targets). Эти
цели сравнимы с процедурами в языках программирования и содержат вызовы команд-заданий (Tasks). Каждое задание — это неделимая, атомарная команда, выполняющая
элементарное действие.

Во фреймворке Maven управление процессом сборки происходит также средствами XML-файлов — POM-файлов, от Project Object Model.

Между целями определяются зависимости — каждая выполнится только после тех, от которых она зависит. Если эти зависимости выполнялись ранее, повторно они не
производятся.

Типичные примеры целей:

- clean — удаление промежуточных файлов;
- compile — компиляция всех классов;
- deploy — развёртывание приложения на сервере.

Конкретный набор целей и их взаимосвязи зависят от специфики проекта.

Сейчас устаревающий Apache Ant практически не используется в проектах. На его место пришли два гиганта: Maven и Gradle.

Сборщики есть не только в С/С++ и Java. Для тех, кто знаком с фронтендом и JS (или хочет познакомиться), интересно будет почитать
о [Gulp](https://tpverstak.ru/gulp/)
и [Webpack](https://medium.com/nuances-of-programming/%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-webpack-%D0%B4%D0%BB%D1%8F-%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%BE%D0%B2-6cafbf562386).

## Maven. Полное погружение

Maven рассмотрим подробно, так как на нём будет строиться проект. Если установлена Intellij IDEA, то ничего дополнительно устанавливать не нужно. Maven
поставляется вместе с нашей IDE.

Если же выбор пал на другую IDE, возможно, потребуется установить плагин Maven. Установка Maven не занимает много времени. Достаточно скачать с
сайта [Maven — Download Apache Maven](http://maven.apache.org/download.cgi) архив с последней стабильной версией. Затем распаковать его и указать системные
переменные среды `M2_HOME` в пути `~\maven\` в зависимости от того, куда его распаковали.

При создании нового проекта (File → New → Project) нужно выбрать Maven и версию SDK. Появится опция Create From Archetype. Разумеется, создать проект можно и
без использования архетипов, но остановимся на этой теме подробнее.

## Структура проекта

Создание проекта сразу создаёт правильную структуру:

* src/main/java. Содержит исходные файлы приложения.
* src/test/java. Содержит тесты.
* src/main/resources. Содержит ресурсы приложения.
* src/test/resources. Содержит ресурсы тестов.
* pom.xml. Основной файл проекта, содержащий информацию о проекте и его зависимостях.

### Описание примерной базовой иерархии файлов в проекте

Пример базовой иерархии файлов в проекте Maven выглядит следующим образом:

```
.
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   │   └── com
    │   │       └── itmo
    │   │           └── App.java
    │   └── resources
    └── test
        ├── java
        │   └── com
        │       └── itmo
        │           └── AppTest.java
        └── resources

```

Файл pom.xml содержит основную информацию о проекте и его зависимостях, а также управляет процессом сборки.

## Файл POM

POM (Project Object Model) — это XML-файл, который содержит информацию о проекте и конфигурацию, используемую Maven для сборки проекта.

Основные теги в файле POM:

```
* <project>. Корневой элемент.
* <modelVersion>. Версия модели POM.
* <groupId>. Идентификатор группы.
* <artifactId>. Идентификатор артефакта.
* <version>. Версия проекта.
* <dependencies>. Зависимости проекта.
* <build>. Настройки сборки.
* <repositories>. Репозитории для поиска зависимостей.
```

Пример файла pom.xml:

```xml

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.itmo</groupId>
    <artifactId>my-app</artifactId>
    <version>1.0-SNAPSHOT</version>
    <dependencies>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.8.1</version>
                <configuration>
                    <source>1.8</source>
                    <target>1.8</target>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>

```

## Значения тега scope

Тег <scope> указывает на область видимости зависимости:

* compile. Зависимость используется для компиляции и доступна в процессе выполнения.
* provided. Зависимость должна быть предоставлена во время выполнения, но не включена в сборку.
* runtime. Зависимость необходима только во время выполнения.
* test. Зависимость используется только для тестирования.

## Жизненный цикл сборки

Maven управляет процессом сборки с помощью понятия жизненного цикла сборки. Жизненный цикл сборки состоит из фаз, каждая из которых выполняет определённые
задачи.

### Фазы жизненного цикла сборки

Основные фазы жизненного цикла сборки:

* validate. Проверка правильности проекта и его конфигурации.
* compile. Компиляция исходного кода.
* test. Запуск тестов.
* package. Упаковка проекта в формат, подходящий для распространения.
* verify. Выполнение проверок качества проекта.
* install. Установка артефакта в локальный репозиторий.
* deploy. Развёртывание артефакта в удалённый репозиторий.

## Плагины

Maven использует плагины для выполнения различных задач в процессе сборки.

### Типы плагинов в Maven

Существует два типа плагинов:

* Плагины для сборки (Build plugins). Выполняются во время сборки проекта.
* Плагины для отчётности (Reporting plugins). Выполняются во время генерации отчётов.

Примеры плагинов для сборки:

* maven-compiler-plugin. Компиляция исходного кода.
* maven-surefire-plugin. Запуск тестов.

Примеры плагинов для отчётности:

* maven-site-plugin. Создание сайта проекта.
* maven-javadoc-plugin. Генерация документации.

## Репозитории

Репозитории — это места хранения артефактов (библиотек, плагинов и т.д.). Maven использует репозитории для поиска и скачивания зависимостей.

### Локальные

Локальный репозиторий находится на вашем компьютере. По умолчанию это директория `~/.m2/repository.`

### Центральный репозиторий

Центральный репозиторий Maven находится на серверах Apache и содержит множество общедоступных артефактов.

### Удалённый репозиторий

Удалённый репозиторий — это репозиторий, который находится на удалённом сервере и используется для хранения артефактов, не находящихся в центральном
репозитории.

## Порядок поиска зависимостей Maven

Maven ищет зависимости в следующем порядке:

1. Локальный репозиторий.
2. Удалённые репозитории, указанные в pom.xml или settings.xml.
3. Центральный репозиторий Maven.

Если зависимость не найдена в локальном репозитории, Maven ищет её в удалённых репозиториях и центральном репозитории.

## Практическое задание

1. Создайте новый проект с maven
2. Добавьте зависимость junit последней версии для тестирования.
3. Напишите простой тест для класса App.java.
4. Соберите проект с помощью команды mvn package.
5. Убедитесь, что тесты проходят успешно.

### [Назад к оглавлению](../../../../../README.md)
